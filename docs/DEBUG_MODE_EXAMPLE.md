# Debug æ¨¡å¼ä½¿ç”¨ç¤ºä¾‹

## æ¦‚è¿°

`--debug` å‚æ•°ä¼šæ˜¾ç¤ºå®Œæ•´çš„ HTTP è¯·æ±‚å’Œå“åº”ä¿¡æ¯ï¼Œç”¨äºè°ƒè¯• API è°ƒç”¨é—®é¢˜ã€‚

## å¯¹æ¯”ç¤ºä¾‹

### æ­£å¸¸æ¨¡å¼ï¼ˆæ—  --debugï¼‰

```bash
./supertail -f /var/log/app.log --format java
```

**è¾“å‡ºï¼š**
```
ğŸš€ SuperTail å¯åŠ¨ - ç›‘æ§ java æ ¼å¼æ—¥å¿—
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“ ç›‘æ§æ–‡ä»¶: /var/log/app.log
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“Œ ä»æ–‡ä»¶æœ«å°¾å¼€å§‹ç›‘æ§æ–°å†…å®¹
â³ ç­‰å¾…æ–°æ—¥å¿—...

âš ï¸  [é‡è¦] 2025-10-13 10:00:01 ERROR Database connection failed
   ğŸ“ æ‘˜è¦: æ•°æ®åº“è¿æ¥å¤±è´¥
```

### Debug æ¨¡å¼ï¼ˆå¸¦ --debugï¼‰

```bash
./supertail -f /var/log/app.log --format java --debug
```

**è¾“å‡ºï¼š**
```
ğŸš€ SuperTail å¯åŠ¨ - ç›‘æ§ java æ ¼å¼æ—¥å¿—
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“ ç›‘æ§æ–‡ä»¶: /var/log/app.log
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“Œ ä»æ–‡ä»¶æœ«å°¾å¼€å§‹ç›‘æ§æ–°å†…å®¹
â³ ç­‰å¾…æ–°æ—¥å¿—...

================================================================================
ğŸ” DEBUG: HTTP è¯·æ±‚è¯¦æƒ…
================================================================================
URL: https://cdnproxy.shifen.de/api.poe.com/v1/chat/completions
Method: POST
Headers:
  Content-Type: application/json
  Authorization: Bearer _dJurJWPM...ZmQjq1Y

Request Body:
{
  "model": "Assistant",
  "messages": [
    {
      "role": "user",
      "content": "ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„æ—¥å¿—åˆ†æåŠ©æ‰‹ã€‚è¯·åˆ†æä»¥ä¸‹ java æ ¼å¼çš„æ—¥å¿—ï¼Œåˆ¤æ–­æ˜¯å¦åº”è¯¥è¿‡æ»¤æ‰ã€‚\n\næ—¥å¿—å†…å®¹ï¼š\n2025-10-13 10:00:01 ERROR Database connection failed\n\nè¯·ä»¥ JSON æ ¼å¼å›å¤..."
    }
  ]
}
================================================================================
â³ å‘é€è¯·æ±‚ä¸­...
================================================================================
ğŸ” DEBUG: HTTP å“åº”è¯¦æƒ…
================================================================================
Status Code: 200 OK
Response Time: 1.456s
Content-Length: 234 bytes

Response Headers:
  Content-Type: application/json
  Date: Mon, 13 Oct 2025 10:23:45 GMT
  X-Request-Id: req_abc123

Response Body:
{
  "id": "chatcmpl-123",
  "choices": [
    {
      "index": 0,
      "message": {
        "role": "assistant",
        "content": "{\n  \"should_filter\": false,\n  \"summary\": \"æ•°æ®åº“è¿æ¥å¤±è´¥\",\n  \"reason\": \"ERRORçº§åˆ«ï¼Œéœ€è¦å…³æ³¨\"\n}"
      },
      "finish_reason": "stop"
    }
  ]
}
================================================================================

âš ï¸  [é‡è¦] 2025-10-13 10:00:01 ERROR Database connection failed
   ğŸ“ æ‘˜è¦: æ•°æ®åº“è¿æ¥å¤±è´¥
```

## Debug æ¨¡å¼æ˜¾ç¤ºçš„ä¿¡æ¯

### 1. HTTP è¯·æ±‚è¯¦æƒ…
- âœ… **URL**ï¼šå®Œæ•´çš„ API ç«¯ç‚¹åœ°å€
- âœ… **Method**ï¼šHTTP æ–¹æ³•ï¼ˆPOSTï¼‰
- âœ… **Headers**ï¼š
  - Content-Type
  - Authorizationï¼ˆToken ä¼šéƒ¨åˆ†éšè—ï¼Œåªæ˜¾ç¤ºå‰åå„ 10 ä¸ªå­—ç¬¦ï¼‰
- âœ… **Request Body**ï¼šæ ¼å¼åŒ–çš„ JSONï¼ŒåŒ…å«å®Œæ•´çš„æç¤ºè¯

### 2. HTTP å“åº”è¯¦æƒ…
- âœ… **Status Code**ï¼šHTTP çŠ¶æ€ç å’ŒçŠ¶æ€æ–‡æœ¬
- âœ… **Response Time**ï¼šAPI å“åº”è€—æ—¶ï¼ˆç²¾ç¡®åˆ°æ¯«ç§’ï¼‰
- âœ… **Content-Length**ï¼šå“åº”ä½“å¤§å°ï¼ˆå­—èŠ‚ï¼‰
- âœ… **Response Headers**ï¼šæ‰€æœ‰å“åº”å¤´ä¿¡æ¯
- âœ… **Response Body**ï¼šæ ¼å¼åŒ–çš„ JSON å“åº”å†…å®¹

## ä½¿ç”¨åœºæ™¯

### 1. è°ƒè¯• API è¿æ¥é—®é¢˜

å½“ API è°ƒç”¨å¤±è´¥æ—¶ï¼Œdebug æ¨¡å¼å¯ä»¥å¸®åŠ©ä½ ï¼š

```bash
./supertail -f /var/log/app.log --format java --debug
```

æ£€æŸ¥ï¼š
- URL æ˜¯å¦æ­£ç¡®
- Authorization Token æ˜¯å¦æœ‰æ•ˆ
- è¯·æ±‚æ˜¯å¦æˆåŠŸå‘é€
- é”™è¯¯ä¿¡æ¯æ˜¯ä»€ä¹ˆ

### 2. éªŒè¯æç¤ºè¯

æŸ¥çœ‹å‘é€ç»™ AI çš„å®Œæ•´æç¤ºè¯å†…å®¹ï¼š

```json
{
  "model": "Assistant",
  "messages": [
    {
      "role": "user",
      "content": "ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„æ—¥å¿—åˆ†æåŠ©æ‰‹ã€‚è¯·åˆ†æä»¥ä¸‹ java æ ¼å¼çš„æ—¥å¿—..."
    }
  ]
}
```

è¿™æ ·å¯ä»¥ï¼š
- ç¡®è®¤æç¤ºè¯æ ¼å¼æ­£ç¡®
- éªŒè¯æ—¥å¿—å†…å®¹æ˜¯å¦å®Œæ•´ä¼ é€’
- ä¼˜åŒ–æç¤ºè¯ä»¥æé«˜å‡†ç¡®æ€§

### 3. åˆ†æ AI å“åº”

æŸ¥çœ‹ AI è¿”å›çš„åŸå§‹ JSONï¼š

```json
{
  "should_filter": false,
  "summary": "æ•°æ®åº“è¿æ¥å¤±è´¥",
  "reason": "ERRORçº§åˆ«ï¼Œéœ€è¦å…³æ³¨"
}
```

è¿™æ ·å¯ä»¥ï¼š
- éªŒè¯ AI åˆ¤æ–­æ˜¯å¦åˆç†
- è°ƒè¯• JSON è§£æé—®é¢˜
- äº†è§£ AI çš„å†³ç­–ä¾æ®

### 4. æ€§èƒ½åˆ†æ

æŸ¥çœ‹æ¯æ¬¡ API è°ƒç”¨çš„è€—æ—¶ï¼š

```
Response Time: 1.456s
```

è¿™æ ·å¯ä»¥ï¼š
- è¯†åˆ«æ…¢å“åº”
- è¯„ä¼° API æ€§èƒ½
- ä¼˜åŒ–è°ƒç”¨é¢‘ç‡

## å¿«é€Ÿæµ‹è¯•

è¿è¡Œæµ‹è¯•è„šæœ¬ä½“éªŒ debug æ¨¡å¼ï¼š

```bash
./test-debug-mode.sh
```

è¿™ä¸ªè„šæœ¬ä¼šï¼š
1. å…ˆå±•ç¤ºæ­£å¸¸æ¨¡å¼çš„è¾“å‡º
2. å†å±•ç¤º debug æ¨¡å¼çš„è¾“å‡º
3. è®©ä½ ç›´è§‚å¯¹æ¯”ä¸¤ç§æ¨¡å¼çš„å·®å¼‚

## ç»„åˆä½¿ç”¨

Debug æ¨¡å¼å¯ä»¥ä¸å…¶ä»–å‚æ•°ç»„åˆï¼š

```bash
# Debug + Verboseï¼ˆæœ€è¯¦ç»†ï¼‰
./supertail -f /var/log/app.log --format java --debug --verbose

# Debug + ä»ç®¡é“è¯»å–
tail -f /var/log/app.log | ./supertail --format java --debug

# Debug + ä¸åŒæ—¥å¿—æ ¼å¼
./supertail -f /var/log/nginx/error.log --format nginx --debug
```

## æ³¨æ„äº‹é¡¹

âš ï¸ **Debug æ¨¡å¼ä¼šäº§ç”Ÿå¤§é‡è¾“å‡º**
- æ¯æ¡æ—¥å¿—éƒ½ä¼šæ‰“å°å®Œæ•´çš„ HTTP è¯·æ±‚å’Œå“åº”
- å»ºè®®ä»…åœ¨è°ƒè¯•æ—¶ä½¿ç”¨
- ç”Ÿäº§ç¯å¢ƒç›‘æ§ä¸å»ºè®®å¼€å¯ debug

âš ï¸ **æ•æ„Ÿä¿¡æ¯**
- API Token ä¼šéƒ¨åˆ†éšè—ï¼ˆåªæ˜¾ç¤ºé¦–å°¾ï¼‰
- æ—¥å¿—å†…å®¹ä¼šå®Œæ•´æ˜¾ç¤º
- è¯·æ³¨æ„ä¿æŠ¤æ•æ„Ÿä¿¡æ¯

âš ï¸ **æ€§èƒ½å½±å“**
- Debug è¾“å‡ºä¼šå¢åŠ ç»ˆç«¯ I/O
- å¯¹ API è°ƒç”¨æœ¬èº«æ— å½±å“
- ä¸»è¦å½±å“æ˜¯è¾“å‡ºåˆ°ç»ˆç«¯çš„æ—¶é—´

## å®ç”¨æŠ€å·§

### 1. é‡å®šå‘ Debug è¾“å‡ºåˆ°æ–‡ä»¶

```bash
./supertail -f /var/log/app.log --format java --debug > debug.log 2>&1
```

### 2. åªæŸ¥çœ‹ HTTP è°ƒç”¨éƒ¨åˆ†

```bash
./supertail -f /var/log/app.log --format java --debug | grep -A 20 "DEBUG:"
```

### 3. æµ‹è¯•å•æ¡æ—¥å¿—

```bash
echo "2025-10-13 10:00:00 ERROR Test" | ./supertail --format java --debug
```

---

**æç¤º**ï¼šæ­£å¸¸ä½¿ç”¨æ—¶ä¸éœ€è¦ `--debug`ï¼Œåªåœ¨é‡åˆ°é—®é¢˜æ—¶å¼€å¯ç”¨äºè¯Šæ–­ã€‚


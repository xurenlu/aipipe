# 04. æ–‡ä»¶ç›‘æ§

> å®æ—¶ç›‘æ§æ—¥å¿—æ–‡ä»¶ï¼Œè‡ªåŠ¨åˆ†ææ–°å¢å†…å®¹

## ğŸ¯ æ¦‚è¿°

AIPipe çš„æ–‡ä»¶ç›‘æ§åŠŸèƒ½å¯ä»¥å®æ—¶ç›‘æ§ä¸€ä¸ªæˆ–å¤šä¸ªæ—¥å¿—æ–‡ä»¶ï¼Œè‡ªåŠ¨åˆ†ææ–°å¢çš„æ—¥å¿—å†…å®¹ï¼Œå¹¶åœ¨å‘ç°é‡è¦æ—¥å¿—æ—¶åŠæ—¶é€šçŸ¥ã€‚

## ğŸ—ï¸ ç›‘æ§æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æ—¥å¿—æ–‡ä»¶      â”‚    â”‚   æ–‡ä»¶ç›‘æ§å™¨    â”‚    â”‚   AI åˆ†æå™¨     â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚
â”‚ â€¢ app.log       â”‚â”€â”€â”€â–¶â”‚ â€¢ fsnotify      â”‚â”€â”€â”€â–¶â”‚ â€¢ å®æ—¶åˆ†æ      â”‚
â”‚ â€¢ error.log     â”‚    â”‚ â€¢ æ–‡ä»¶è½®è½¬      â”‚    â”‚ â€¢ é‡è¦æ€§åˆ¤æ–­    â”‚
â”‚ â€¢ access.log    â”‚    â”‚ â€¢ æ–­ç‚¹ç»­ä¼       â”‚    â”‚ â€¢ ç»“æœè¾“å‡º      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚   é€šçŸ¥ç³»ç»Ÿ      â”‚
                       â”‚                 â”‚
                       â”‚ â€¢ å®æ—¶å‘Šè­¦      â”‚
                       â”‚ â€¢ å¤šæ¸ é“é€šçŸ¥    â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç›‘æ§å•ä¸ªæ–‡ä»¶

```bash
# ç›‘æ§æŒ‡å®šæ–‡ä»¶
aipipe monitor --file /var/log/app.log --format java

# ç›‘æ§ Nginx æ—¥å¿—
aipipe monitor --file /var/log/nginx/access.log --format nginx

# ç›‘æ§ Docker æ—¥å¿—
aipipe monitor --file /var/log/docker/container.log --format docker
```

### 2. ç›‘æ§å¤šä¸ªæ–‡ä»¶

```bash
# æ·»åŠ ç›‘æ§æ–‡ä»¶
aipipe dashboard add

# æŒ‰æç¤ºè¾“å…¥æ–‡ä»¶ä¿¡æ¯
æ–‡ä»¶è·¯å¾„: /var/log/app.log
æ—¥å¿—æ ¼å¼: java
ä¼˜å…ˆçº§: 10

# å¯åŠ¨ç›‘æ§æ‰€æœ‰é…ç½®çš„æ–‡ä»¶
aipipe monitor
```

## ğŸ“ æ–‡ä»¶ç®¡ç†

### 1. æ·»åŠ ç›‘æ§æ–‡ä»¶

```bash
# äº¤äº’å¼æ·»åŠ 
aipipe dashboard add

# æ‰‹åŠ¨æ·»åŠ ï¼ˆé€šè¿‡é…ç½®æ–‡ä»¶ï¼‰
aipipe dashboard add --file /var/log/app.log --format java --priority 10
```

### 2. åˆ—å‡ºç›‘æ§æ–‡ä»¶

```bash
# æ˜¾ç¤ºæ‰€æœ‰ç›‘æ§æ–‡ä»¶
aipipe dashboard list

# æ˜¾ç¤ºæ–‡ä»¶çŠ¶æ€
aipipe dashboard show
```

è¾“å‡ºç¤ºä¾‹ï¼š
```
ğŸ“ ç›‘æ§æ–‡ä»¶åˆ—è¡¨ (2 ä¸ªæ–‡ä»¶)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
1. /var/log/app.log
   ğŸ“ æ ¼å¼: java
   âš¡ ä¼˜å…ˆçº§: 10
   âœ… çŠ¶æ€: å·²å¯ç”¨
   ğŸ“Š å¤§å°: 1.2MB
   ğŸ•’ ä¿®æ”¹æ—¶é—´: 2024-01-01 10:00:00

2. /var/log/nginx/access.log
   ğŸ“ æ ¼å¼: nginx
   âš¡ ä¼˜å…ˆçº§: 20
   âœ… çŠ¶æ€: å·²å¯ç”¨
   ğŸ“Š å¤§å°: 5.8MB
   ğŸ•’ ä¿®æ”¹æ—¶é—´: 2024-01-01 10:05:00
```

### 3. ç§»é™¤ç›‘æ§æ–‡ä»¶

```bash
# ç§»é™¤æŒ‡å®šæ–‡ä»¶
aipipe dashboard remove /var/log/app.log

# äº¤äº’å¼ç§»é™¤
aipipe dashboard remove
```

## âš™ï¸ ç›‘æ§é…ç½®

### 1. é…ç½®æ–‡ä»¶ç»“æ„

ç›‘æ§é…ç½®ä¿å­˜åœ¨ `~/.aipipe-monitor.json`ï¼š

```json
{
  "files": [
    {
      "path": "/var/log/app.log",
      "format": "java",
      "enabled": true,
      "priority": 10
    },
    {
      "path": "/var/log/nginx/access.log",
      "format": "nginx",
      "enabled": true,
      "priority": 20
    }
  ]
}
```

### 2. ä¼˜å…ˆçº§è®¾ç½®

ä¼˜å…ˆçº§æ•°å­—è¶Šå°ï¼Œä¼˜å…ˆçº§è¶Šé«˜ï¼š

- **1-10**: å…³é”®ç³»ç»Ÿæ—¥å¿—ï¼ˆå¦‚ç³»ç»Ÿé”™è¯¯ï¼‰
- **11-20**: åº”ç”¨æ—¥å¿—ï¼ˆå¦‚ä¸šåŠ¡é”™è¯¯ï¼‰
- **21-30**: è®¿é—®æ—¥å¿—ï¼ˆå¦‚ Web è®¿é—®ï¼‰
- **31-40**: è°ƒè¯•æ—¥å¿—ï¼ˆå¦‚è¯¦ç»†è°ƒè¯•ä¿¡æ¯ï¼‰

### 3. æ–‡ä»¶çŠ¶æ€ç®¡ç†

```bash
# æŸ¥çœ‹æ–‡ä»¶çŠ¶æ€
aipipe dashboard show

# åˆ—å‡ºæ‰€æœ‰ç›‘æ§æ–‡ä»¶
aipipe dashboard list

# ç§»é™¤ç›‘æ§æ–‡ä»¶
aipipe dashboard remove /var/log/app.log
```

## ğŸ”„ ç›‘æ§æ¨¡å¼

### 1. è‡ªåŠ¨æ¨¡å¼

ç›‘æ§æ‰€æœ‰é…ç½®çš„æ–‡ä»¶ï¼š

```bash
# å¯åŠ¨è‡ªåŠ¨ç›‘æ§
aipipe monitor

# åå°è¿è¡Œ
nohup aipipe monitor > monitor.log 2>&1 &
```

### 2. æ‰‹åŠ¨æ¨¡å¼

ç›‘æ§æŒ‡å®šæ–‡ä»¶ï¼š

```bash
# ç›‘æ§å•ä¸ªæ–‡ä»¶
aipipe monitor --file /var/log/app.log --format java

# ç›‘æ§å¤šä¸ªæ–‡ä»¶ï¼ˆéœ€è¦å¤šæ¬¡è°ƒç”¨ï¼‰
aipipe monitor --file /var/log/app.log --format java &
aipipe monitor --file /var/log/nginx/access.log --format nginx &
```

## ğŸ“Š ç›‘æ§çŠ¶æ€

### 1. å®æ—¶çŠ¶æ€

```bash
# æŸ¥çœ‹ç›‘æ§çŠ¶æ€
aipipe dashboard show
```

è¾“å‡ºç¤ºä¾‹ï¼š
```
ğŸ” AIPipe ç³»ç»ŸçŠ¶æ€
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“‹ é…ç½®ä¿¡æ¯:
  AIç«¯ç‚¹: https://api.openai.com/v1/chat/completions
  æ¨¡å‹: gpt-3.5-turbo
  æœ€å¤§é‡è¯•: 3
  è¶…æ—¶æ—¶é—´: 30ç§’
  é¢‘ç‡é™åˆ¶: 60æ¬¡/åˆ†é’Ÿ
  æœ¬åœ°è¿‡æ»¤: true

ğŸ“ ç›‘å¬çŠ¶æ€:
  ğŸš€ ç›‘æ§æ¨¡å¼: å¤šæ–‡ä»¶ç›‘æ§
  ğŸ“ ç›‘æ§æ–‡ä»¶: 2 ä¸ªæ–‡ä»¶
  ğŸ“Š æ€»å¤§å°: 7.0MB
  ğŸ•’ æœ€åæ›´æ–°: 2024-01-01 10:05:00

ğŸ”§ æ¨¡å—çŠ¶æ€:
  âœ… ç¼“å­˜ç³»ç»Ÿ: å·²å¯ç”¨ (15 é¡¹ç›®, 85.2% å‘½ä¸­ç‡)
  ğŸ“¢ é€šçŸ¥ç³»ç»Ÿ: 2 ä¸ªé€šçŸ¥å™¨å·²å¯ç”¨
  ğŸ” è§„åˆ™å¼•æ“: 3 ä¸ªè§„åˆ™å·²å¯ç”¨
  ğŸ¤– AIæœåŠ¡: 1 ä¸ªæœåŠ¡å·²å¯ç”¨
  ğŸ“ æ–‡ä»¶ç›‘æ§: 2 ä¸ªæ–‡ä»¶å·²ç›‘æ§
```

### 2. æ–‡ä»¶çŠ¶æ€è¯¦æƒ…

```bash
# æŸ¥çœ‹æ–‡ä»¶çŠ¶æ€è¯¦æƒ…
aipipe dashboard status
```

## ğŸ”§ é«˜çº§åŠŸèƒ½

### 1. æ–‡ä»¶è½®è½¬æ”¯æŒ

AIPipe è‡ªåŠ¨å¤„ç†æ—¥å¿—æ–‡ä»¶è½®è½¬ï¼š

```bash
# ç›‘æ§è½®è½¬çš„æ—¥å¿—æ–‡ä»¶
aipipe monitor --file /var/log/app.log --format java

# å½“æ–‡ä»¶è½®è½¬æ—¶ï¼Œè‡ªåŠ¨åˆ‡æ¢åˆ°æ–°æ–‡ä»¶
# app.log -> app.log.1 -> app.log.2.gz
```

### 2. æ–­ç‚¹ç»­ä¼ 

ç›‘æ§ä¸­æ–­åå¯ä»¥ä»ä¸Šæ¬¡ä½ç½®ç»§ç»­ï¼š

```bash
# å¯åŠ¨ç›‘æ§ï¼ˆè‡ªåŠ¨ä»ä¸Šæ¬¡ä½ç½®ç»§ç»­ï¼‰
aipipe monitor

# å¼ºåˆ¶ä»å¤´å¼€å§‹
aipipe monitor --from-beginning
```

### 3. æ–‡ä»¶è¿‡æ»¤

```bash
# åªç›‘æ§ç‰¹å®šæ¨¡å¼çš„æ–‡ä»¶
aipipe monitor --pattern "*.log"

# æ’é™¤ç‰¹å®šæ–‡ä»¶
aipipe monitor --exclude "*.tmp"
```

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### 1. å¹¶å‘ç›‘æ§

```json
{
  "monitor": {
    "max_concurrent_files": 10,
    "buffer_size": 4096,
    "poll_interval": 100
  }
}
```

### 2. å†…å­˜ç®¡ç†

```json
{
  "memory": {
    "max_memory_usage": "512MB",
    "gc_interval": 300
  }
}
```

### 3. æ‰¹å¤„ç†ä¼˜åŒ–

```json
{
  "batch_processing": {
    "enabled": true,
    "batch_size": 10,
    "batch_timeout": 5
  }
}
```

## ğŸ” æ•…éšœæ’é™¤

### 1. æ–‡ä»¶ä¸å­˜åœ¨

```bash
# æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
ls -la /var/log/app.log

# æ£€æŸ¥æ–‡ä»¶æƒé™
ls -la /var/log/app.log
```

### 2. æƒé™é—®é¢˜

```bash
# æ£€æŸ¥æ–‡ä»¶æƒé™
ls -la /var/log/app.log

# ä¿®æ”¹æƒé™
sudo chmod 644 /var/log/app.log

# ä¿®æ”¹æ‰€æœ‰è€…
sudo chown $USER:$USER /var/log/app.log
```

### 3. æ–‡ä»¶è¢«å ç”¨

```bash
# æ£€æŸ¥æ–‡ä»¶æ˜¯å¦è¢«å…¶ä»–è¿›ç¨‹å ç”¨
lsof /var/log/app.log

# åœæ­¢å ç”¨è¿›ç¨‹
sudo kill -9 <PID>
```

## ğŸ“‹ æœ€ä½³å®è·µ

### 1. æ–‡ä»¶é€‰æ‹©

- é€‰æ‹©é‡è¦çš„æ—¥å¿—æ–‡ä»¶è¿›è¡Œç›‘æ§
- é¿å…ç›‘æ§è¿‡å¤§çš„æ–‡ä»¶ï¼ˆ>1GBï¼‰
- å®šæœŸæ¸…ç†æ—§çš„æ—¥å¿—æ–‡ä»¶

### 2. ä¼˜å…ˆçº§è®¾ç½®

- ç³»ç»Ÿé”™è¯¯æ—¥å¿—ï¼šä¼˜å…ˆçº§ 1-10
- åº”ç”¨é”™è¯¯æ—¥å¿—ï¼šä¼˜å…ˆçº§ 11-20
- è®¿é—®æ—¥å¿—ï¼šä¼˜å…ˆçº§ 21-30
- è°ƒè¯•æ—¥å¿—ï¼šä¼˜å…ˆçº§ 31-40

### 3. æ€§èƒ½è€ƒè™‘

- åˆç†è®¾ç½®å¹¶å‘ç›‘æ§æ–‡ä»¶æ•°é‡
- å¯ç”¨æ‰¹å¤„ç†ä¼˜åŒ–
- å®šæœŸæ¸…ç†ç¼“å­˜

### 4. ç›‘æ§ç­–ç•¥

- ç›‘æ§å…³é”®ä¸šåŠ¡æ—¥å¿—
- è®¾ç½®åˆç†çš„å‘Šè­¦é˜ˆå€¼
- å®šæœŸæ£€æŸ¥ç›‘æ§çŠ¶æ€

## ğŸ¯ ä½¿ç”¨åœºæ™¯

### åœºæ™¯ä¸€ï¼šWeb åº”ç”¨ç›‘æ§

```bash
# 1. æ·»åŠ åº”ç”¨æ—¥å¿—ç›‘æ§
aipipe dashboard add
# è¾“å…¥: /var/log/myapp/app.log, java, 10

# 2. æ·»åŠ è®¿é—®æ—¥å¿—ç›‘æ§
aipipe dashboard add
# è¾“å…¥: /var/log/nginx/access.log, nginx, 20

# 3. å¯åŠ¨ç›‘æ§
aipipe monitor
```

### åœºæ™¯äºŒï¼šå¾®æœåŠ¡ç›‘æ§

```bash
# 1. æ·»åŠ å¤šä¸ªæœåŠ¡æ—¥å¿—
aipipe dashboard add  # user-service.log
aipipe dashboard add  # order-service.log
aipipe dashboard add  # payment-service.log

# 2. å¯åŠ¨ç›‘æ§
aipipe monitor
```

### åœºæ™¯ä¸‰ï¼šDocker å®¹å™¨ç›‘æ§

```bash
# 1. ç›‘æ§å®¹å™¨æ—¥å¿—
aipipe monitor --file /var/log/docker/container.log --format docker

# 2. ç›‘æ§å¤šä¸ªå®¹å™¨
aipipe dashboard add  # container1.log
aipipe dashboard add  # container2.log
aipipe monitor
```

## ğŸ‰ æ€»ç»“

AIPipe çš„æ–‡ä»¶ç›‘æ§åŠŸèƒ½æä¾›äº†ï¼š

- **å®æ—¶ç›‘æ§**: è‡ªåŠ¨æ£€æµ‹æ–‡ä»¶å˜åŒ–
- **å¤šæ–‡ä»¶æ”¯æŒ**: åŒæ—¶ç›‘æ§å¤šä¸ªæ–‡ä»¶
- **æ™ºèƒ½åˆ†æ**: AI é©±åŠ¨çš„æ—¥å¿—åˆ†æ
- **çµæ´»é…ç½®**: ä¸°å¯Œçš„é…ç½®é€‰é¡¹
- **é«˜æ€§èƒ½**: ä¼˜åŒ–çš„ç›‘æ§æ€§èƒ½

---

*ç»§ç»­é˜…è¯»: [05. é€šçŸ¥ç³»ç»Ÿ](05-notifications.md)*

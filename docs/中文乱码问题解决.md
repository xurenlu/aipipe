# ä¸­æ–‡é€šçŸ¥ä¹±ç é—®é¢˜å·²è§£å†³

## ðŸŽ¯ é—®é¢˜æè¿°

ç”¨æˆ·åé¦ˆï¼š
- âœ… ç»ˆç«¯æ˜¾ç¤ºæ­£å¸¸ï¼š`âš ï¸ [é‡è¦] ç»“åˆææ–™,è¿ç”¨"æ­£ç¡®å‘æŒ¥ä¸»è§‚èƒ½åŠ¨æ€§"çš„çŸ¥è¯†...`
- âŒ ç³»ç»Ÿé€šçŸ¥æ˜¾ç¤ºä¹±ç ï¼šæ— æ³•æ­£ç¡®æ˜¾ç¤ºä¸­æ–‡å­—ç¬¦

## ðŸ” é—®é¢˜åŽŸå› 

### æ ¹æœ¬åŽŸå› ï¼šå­—ç¬¦ç¼–ç é—®é¢˜

å½“ä½¿ç”¨ `osascript -e` ç›´æŽ¥ä¼ é€’åŒ…å«ä¸­æ–‡çš„å­—ç¬¦ä¸²æ—¶ï¼Œå¯èƒ½ä¼šå‡ºçŽ°ç¼–ç é—®é¢˜ï¼š

```go
// é—®é¢˜ä»£ç ï¼ˆæ”¹è¿›å‰ï¼‰
cmd := exec.Command("osascript", "-e", script)
```

AppleScript åœ¨å¤„ç† UTF-8 ä¸­æ–‡å­—ç¬¦æ—¶ï¼Œé€šè¿‡ `-e` å‚æ•°ä¼ é€’å¯èƒ½ä¼šå¯¼è‡´ç¼–ç æ··ä¹±ã€‚

## âœ… è§£å†³æ–¹æ¡ˆ

### æ”¹è¿›æŽªæ–½

#### 1. ä½¿ç”¨æ ‡å‡†è¾“å…¥æ–¹å¼

å°† AppleScript è„šæœ¬é€šè¿‡æ ‡å‡†è¾“å…¥ä¼ é€’ï¼Œè€Œä¸æ˜¯å‘½ä»¤è¡Œå‚æ•°ï¼š

```go
// æ”¹è¿›åŽçš„ä»£ç 
cmd := exec.Command("osascript", "-")
cmd.Stdin = strings.NewReader(script)
```

**ä¼˜åŠ¿ï¼š**
- æ ‡å‡†è¾“å…¥æ›´å¥½åœ°ä¿æŒ UTF-8 ç¼–ç 
- é¿å…å‘½ä»¤è¡Œå‚æ•°çš„è½¬ä¹‰å’Œç¼–ç é—®é¢˜
- æ›´å¯é åœ°å¤„ç†ç‰¹æ®Šå­—ç¬¦

#### 2. è®¾ç½® UTF-8 çŽ¯å¢ƒå˜é‡

ç¡®ä¿ osascript ä½¿ç”¨ UTF-8 ç¼–ç ï¼š

```go
cmd.Env = append(os.Environ(), "LANG=zh_CN.UTF-8")
```

**ä½œç”¨ï¼š**
- æ˜Žç¡®æŒ‡å®šä½¿ç”¨ UTF-8 å­—ç¬¦é›†
- æ”¯æŒä¸­æ–‡ç®€ä½“ï¼ˆzh_CNï¼‰
- ç»§æ‰¿çˆ¶è¿›ç¨‹çš„å…¶ä»–çŽ¯å¢ƒå˜é‡

### å®Œæ•´çš„æ”¹è¿›ä»£ç 

```go
func sendNotification(summary, logLine string) {
    // ... å‡†å¤‡å†…å®¹ ...
    
    // ä½¿ç”¨æ ‡å‡†è¾“å…¥å‘é€é€šçŸ¥
    cmd := exec.Command("osascript", "-")
    cmd.Stdin = strings.NewReader(script)
    cmd.Env = append(os.Environ(), "LANG=zh_CN.UTF-8")
    
    err := cmd.Run()
    // ... é”™è¯¯å¤„ç† ...
}
```

## ðŸ§ª æµ‹è¯•éªŒè¯

### å¿«é€Ÿæµ‹è¯•

```bash
# æµ‹è¯•ä¸­æ–‡é€šçŸ¥
./test-chinese-notification.sh
```

### æ‰‹åŠ¨æµ‹è¯•

#### æµ‹è¯• 1: osascript ä¸­æ–‡ï¼ˆæ–¹æ³•å¯¹æ¯”ï¼‰

```bash
# æ–¹æ³• A: ä½¿ç”¨ -e å‚æ•°ï¼ˆå¯èƒ½æœ‰é—®é¢˜ï¼‰
osascript -e 'display notification "æ•°æ®åº“è¿žæŽ¥å¤±è´¥" with title "æµ‹è¯•" subtitle "ä¸­æ–‡æ‘˜è¦"'

# æ–¹æ³• B: ä½¿ç”¨æ ‡å‡†è¾“å…¥ï¼ˆæŽ¨èï¼‰
echo 'display notification "æ•°æ®åº“è¿žæŽ¥å¤±è´¥" with title "æµ‹è¯•" subtitle "ä¸­æ–‡æ‘˜è¦"' | LANG=zh_CN.UTF-8 osascript -
```

#### æµ‹è¯• 2: SuperTail ä¸­æ–‡æ—¥å¿—

```bash
# æµ‹è¯•åŒ…å«ä¸­æ–‡çš„é”™è¯¯æ—¥å¿—
echo '2025-10-13 ERROR æ•°æ®åº“è¿žæŽ¥å¤±è´¥ï¼šè¶…æ—¶' | ./supertail --format java

echo '2025-10-13 ERROR ç”¨æˆ·è®¤è¯å¤±è´¥ï¼šå¯†ç é”™è¯¯' | ./supertail --format java

echo '2025-10-13 ERROR æ–‡ä»¶è¯»å–å¤±è´¥ï¼šæƒé™ä¸è¶³' | ./supertail --format java
```

### é¢„æœŸç»“æžœ

**é€šçŸ¥åº”è¯¥æ­£ç¡®æ˜¾ç¤ºï¼š**
- **æ ‡é¢˜**ï¼šâš ï¸ é‡è¦æ—¥å¿—å‘Šè­¦
- **å‰¯æ ‡é¢˜ï¼ˆæ‘˜è¦ï¼‰**ï¼šæ•°æ®åº“è¿žæŽ¥å¤±è´¥ / ç”¨æˆ·è®¤è¯å¤±è´¥ / æ–‡ä»¶è¯»å–å¤±è´¥
- **å†…å®¹ï¼ˆæ—¥å¿—ï¼‰**ï¼šå®Œæ•´çš„ä¸­æ–‡æ—¥å¿—å†…å®¹

## ðŸ“ å¸¸è§ä¸­æ–‡ç¼–ç é—®é¢˜

### é—®é¢˜ 1: ç»ˆç«¯ç¼–ç è®¾ç½®

**ç—‡çŠ¶ï¼š** ä¸ä»…é€šçŸ¥ä¹±ç ï¼Œç»ˆç«¯ä¹Ÿæ˜¾ç¤ºä¹±ç 

**è§£å†³æ–¹æ³•ï¼š**
```bash
# æ£€æŸ¥å½“å‰ç¼–ç 
locale

# è®¾ç½®ä¸º UTF-8
export LANG=zh_CN.UTF-8
export LC_ALL=zh_CN.UTF-8

# æ°¸ä¹…è®¾ç½®ï¼ˆæ·»åŠ åˆ° ~/.zshrc æˆ– ~/.bash_profileï¼‰
echo 'export LANG=zh_CN.UTF-8' >> ~/.zshrc
echo 'export LC_ALL=zh_CN.UTF-8' >> ~/.zshrc
```

### é—®é¢˜ 2: Go ç¨‹åºçš„å­—ç¬¦ä¸²å¤„ç†

**Go è¯­è¨€é»˜è®¤ä½¿ç”¨ UTF-8**ï¼Œæ‰€ä»¥å­—ç¬¦ä¸²æœ¬èº«ä¸æ˜¯é—®é¢˜ã€‚é—®é¢˜åœ¨äºŽå¦‚ä½•ä¼ é€’ç»™å¤–éƒ¨å‘½ä»¤ã€‚

**æ­£ç¡®åšæ³•ï¼š**
- âœ… ä½¿ç”¨æ ‡å‡†è¾“å…¥ï¼ˆstdinï¼‰
- âœ… è®¾ç½®æ­£ç¡®çš„çŽ¯å¢ƒå˜é‡
- âŒ é¿å…é€šè¿‡å‘½ä»¤è¡Œå‚æ•°ä¼ é€’å¤§é‡ä¸­æ–‡

### é—®é¢˜ 3: AppleScript çš„å­—ç¬¦ç¼–ç 

AppleScript é»˜è®¤æ”¯æŒ UTF-8ï¼Œä½†é€šè¿‡ä¸åŒæ–¹å¼è°ƒç”¨å¯èƒ½æœ‰å·®å¼‚ï¼š

| è°ƒç”¨æ–¹å¼ | ä¸­æ–‡æ”¯æŒ | æŽ¨èåº¦ |
|---------|---------|--------|
| `osascript -e "..."` | âš ï¸ å¯èƒ½æœ‰é—®é¢˜ | âŒ |
| `osascript -` (stdin) | âœ… è‰¯å¥½ | âœ… |
| `osascript script.scpt` | âœ… è‰¯å¥½ | âœ… |

## ðŸ”§ å®Œæ•´çš„æ”¹è¿›åˆ—è¡¨

### ä»£ç æ”¹è¿›
1. âœ… ä½¿ç”¨ `osascript -` æ›¿ä»£ `osascript -e`
2. âœ… è®¾ç½® `LANG=zh_CN.UTF-8` çŽ¯å¢ƒå˜é‡
3. âœ… ä¿æŒ `escapeForAppleScript` å‡½æ•°ï¼ˆåªè½¬ä¹‰ç‰¹æ®Šå­—ç¬¦ï¼‰

### æµ‹è¯•æ”¹è¿›
1. âœ… åˆ›å»º `test-chinese-notification.sh` æµ‹è¯•è„šæœ¬
2. âœ… åŒ…å«å¤šä¸ªä¸­æ–‡æµ‹è¯•ç”¨ä¾‹
3. âœ… æµ‹è¯•é•¿ä¸­æ–‡å†…å®¹æˆªæ–­

### æ–‡æ¡£æ”¹è¿›
1. âœ… åˆ›å»ºæœ¬è¯´æ˜Žæ–‡æ¡£
2. âœ… æ›´æ–°ä¸»æ–‡æ¡£ä¸­çš„è¯´æ˜Ž

## ðŸŽ¬ ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹ 1: ç›‘æŽ§åŒ…å«ä¸­æ–‡çš„æ—¥å¿—

```bash
# åˆ›å»ºæµ‹è¯•æ—¥å¿—
cat > test-chinese.log << 'EOF'
2025-10-13 10:00:00 INFO åº”ç”¨å¯åŠ¨æˆåŠŸ
2025-10-13 10:00:01 INFO ç”¨æˆ·ç™»å½•ï¼šå¼ ä¸‰
2025-10-13 10:00:02 ERROR æ•°æ®åº“è¿žæŽ¥å¤±è´¥ï¼šè¿žæŽ¥è¶…æ—¶
2025-10-13 10:00:03 ERROR æ–‡ä»¶è¯»å–é”™è¯¯ï¼šæƒé™ä¸è¶³
2025-10-13 10:00:04 WARN å†…å­˜ä½¿ç”¨çŽ‡è¿‡é«˜ï¼š85%
EOF

# ç›‘æŽ§æ—¥å¿—
cat test-chinese.log | ./supertail --format java
```

### ç¤ºä¾‹ 2: å®žæ—¶ç›‘æŽ§ä¸­æ–‡æ—¥å¿—

```bash
# ç›‘æŽ§åŒ…å«ä¸­æ–‡çš„å®žæ—¶æ—¥å¿—
tail -f /var/log/app-chinese.log | ./supertail --format java

# æˆ–ä½¿ç”¨æ–‡ä»¶ç›‘æŽ§æ¨¡å¼
./supertail -f /var/log/app-chinese.log --format java
```

### ç¤ºä¾‹ 3: æµ‹è¯•å„ç§ä¸­æ–‡å†…å®¹

```bash
# çŸ­ä¸­æ–‡
echo '2025-10-13 ERROR å¤±è´¥' | ./supertail --format java

# ä¸­ç­‰é•¿åº¦ä¸­æ–‡
echo '2025-10-13 ERROR æ•°æ®åº“è¿žæŽ¥å¤±è´¥ï¼šè¶…æ—¶' | ./supertail --format java

# é•¿ä¸­æ–‡ï¼ˆä¼šè¢«æˆªæ–­ï¼‰
echo '2025-10-13 ERROR è¿™æ˜¯ä¸€æ¡éžå¸¸é•¿çš„ä¸­æ–‡é”™è¯¯æ—¥å¿—æ¶ˆæ¯ï¼ŒåŒ…å«äº†å¾ˆå¤šè¯¦ç»†çš„é”™è¯¯ä¿¡æ¯å’Œä¸Šä¸‹æ–‡ï¼Œç”¨äºŽæµ‹è¯•ç³»ç»Ÿé€šçŸ¥å¦‚ä½•å¤„ç†è¶…é•¿çš„ä¸­æ–‡å†…å®¹' | ./supertail --format java
```

## ðŸ“š æŠ€æœ¯è¯´æ˜Ž

### UTF-8 ç¼–ç åœ¨ Go ä¸­

Go è¯­è¨€çš„å­—ç¬¦ä¸²æ˜¯ UTF-8 ç¼–ç çš„å­—èŠ‚åºåˆ—ï¼š

```go
s := "æ•°æ®åº“è¿žæŽ¥å¤±è´¥"
// s æ˜¯ UTF-8 ç¼–ç çš„å­—èŠ‚åºåˆ—
// len(s) è¿”å›žå­—èŠ‚æ•°ï¼Œä¸æ˜¯å­—ç¬¦æ•°
```

### ä¸ºä»€ä¹ˆæ ‡å‡†è¾“å…¥æ›´å¥½

**ä½¿ç”¨ `-e` å‚æ•°ï¼š**
```bash
osascript -e 'display notification "ä¸­æ–‡"'
# å­—ç¬¦ä¸²é€šè¿‡ shell è§£æž â†’ ä¼ é€’ç»™ osascript
# å¯èƒ½ç»åŽ†å¤šæ¬¡ç¼–ç è½¬æ¢
```

**ä½¿ç”¨æ ‡å‡†è¾“å…¥ï¼š**
```bash
echo 'display notification "ä¸­æ–‡"' | osascript -
# å­—ç¬¦ä¸²ç›´æŽ¥é€šè¿‡ç®¡é“ä¼ è¾“
# ä¿æŒåŽŸå§‹ UTF-8 ç¼–ç 
```

## ðŸ’¡ æœ€ä½³å®žè·µ

### 1. åœ¨ä»£ç ä¸­

```go
// âœ… æŽ¨èï¼šä½¿ç”¨æ ‡å‡†è¾“å…¥
cmd := exec.Command("osascript", "-")
cmd.Stdin = strings.NewReader(script)
cmd.Env = append(os.Environ(), "LANG=zh_CN.UTF-8")

// âŒ ä¸æŽ¨èï¼šä½¿ç”¨ -e å‚æ•°ä¼ é€’ä¸­æ–‡
cmd := exec.Command("osascript", "-e", script)
```

### 2. åœ¨ç»ˆç«¯ä¸­

```bash
# âœ… ç¡®ä¿ç»ˆç«¯ä½¿ç”¨ UTF-8
export LANG=zh_CN.UTF-8

# âœ… æµ‹è¯•ç¼–ç æ˜¯å¦æ­£ç¡®
echo "æµ‹è¯•ä¸­æ–‡" | cat

# âœ… éªŒè¯çŽ¯å¢ƒå˜é‡
locale
```

### 3. åœ¨æµ‹è¯•ä¸­

```bash
# âœ… ä½¿ç”¨çœŸå®žçš„ä¸­æ–‡æµ‹è¯•ç”¨ä¾‹
./test-chinese-notification.sh

# âœ… æµ‹è¯•ä¸åŒé•¿åº¦çš„ä¸­æ–‡
echo 'çŸ­' | ./supertail --format java
echo 'ä¸­ç­‰é•¿åº¦çš„ä¸­æ–‡å†…å®¹' | ./supertail --format java
echo 'å¾ˆé•¿å¾ˆé•¿çš„ä¸­æ–‡å†…å®¹...' | ./supertail --format java
```

## âœ… éªŒè¯æ¸…å•

åœ¨æŠ¥å‘Šä¸­æ–‡æ˜¾ç¤ºé—®é¢˜å‰ï¼Œè¯·ç¡®è®¤ï¼š

- [ ] ç»ˆç«¯çŽ¯å¢ƒå˜é‡è®¾ç½®æ­£ç¡®ï¼š`echo $LANG` åº”è¯¥æ˜¯ `zh_CN.UTF-8`
- [ ] ç»ˆç«¯å­—ä½“æ”¯æŒä¸­æ–‡æ˜¾ç¤º
- [ ] æ‰‹åŠ¨æµ‹è¯• osascript å¯ä»¥æ˜¾ç¤ºä¸­æ–‡ï¼š
  ```bash
  echo 'display notification "æµ‹è¯•" with title "ä¸­æ–‡"' | osascript -
  ```
- [ ] SuperTail å·²é‡æ–°ç¼–è¯‘ï¼ˆåŒ…å«æœ€æ–°çš„ä¸­æ–‡ä¿®å¤ï¼‰
- [ ] è¿è¡Œä¸­æ–‡æµ‹è¯•è„šæœ¬ï¼š`./test-chinese-notification.sh`

## ðŸ” Debug æ–¹æ³•

å¦‚æžœè¿˜æœ‰ä¸­æ–‡ä¹±ç é—®é¢˜ï¼š

### 1. æ£€æŸ¥ç¼–ç çŽ¯å¢ƒ

```bash
# æŸ¥çœ‹æ‰€æœ‰ locale è®¾ç½®
locale

# åº”è¯¥çœ‹åˆ°ç±»ä¼¼ï¼š
# LANG="zh_CN.UTF-8"
# LC_CTYPE="zh_CN.UTF-8"
# LC_ALL="zh_CN.UTF-8"
```

### 2. æµ‹è¯• osascript ç›´æŽ¥è°ƒç”¨

```bash
# æµ‹è¯•æ–¹æ³• A
osascript -e 'display notification "æµ‹è¯•ä¸­æ–‡" with title "æ ‡é¢˜"'

# æµ‹è¯•æ–¹æ³• B
echo 'display notification "æµ‹è¯•ä¸­æ–‡" with title "æ ‡é¢˜"' | osascript -

# æ¯”è¾ƒä¸¤ç§æ–¹æ³•çš„æ˜¾ç¤ºæ•ˆæžœ
```

### 3. æŸ¥çœ‹ SuperTail è¯¦ç»†è¾“å‡º

```bash
# ä½¿ç”¨ verbose æ¨¡å¼
echo '2025-10-13 ERROR æµ‹è¯•ä¸­æ–‡' | ./supertail --format java --verbose

# ä½¿ç”¨ debug æ¨¡å¼æŸ¥çœ‹ API è¿”å›ž
echo '2025-10-13 ERROR æµ‹è¯•ä¸­æ–‡' | ./supertail --format java --debug
```

### 4. æ£€æŸ¥ Go ç¨‹åºçš„å­—ç¬¦ä¸²

```bash
# åœ¨ debug è¾“å‡ºä¸­æ£€æŸ¥å­—ç¬¦ä¸²æ˜¯å¦æ­£ç¡®
# æ‘˜è¦å’Œæ—¥å¿—å†…å®¹åº”è¯¥æ˜¯æ­£ç¡®çš„ UTF-8
```

## ðŸ“ž è¿˜æ˜¯æœ‰é—®é¢˜ï¼Ÿ

å¦‚æžœæŒ‰ç…§ä»¥ä¸Šæ­¥éª¤ä»ç„¶æœ‰ä¹±ç ï¼Œè¯·æä¾›ï¼š

1. **ç»ˆç«¯ locale è®¾ç½®ï¼š**
   ```bash
   locale
   ```

2. **æµ‹è¯• osascript çš„ç»“æžœï¼š**
   ```bash
   echo 'display notification "æµ‹è¯•" with title "ä¸­æ–‡"' | osascript -
   ```

3. **SuperTail çš„è¾“å‡ºï¼š**
   ```bash
   echo '2025-10-13 ERROR æµ‹è¯•' | ./supertail --format java --verbose
   ```

4. **æˆªå›¾ï¼š**
   - ç»ˆç«¯æ˜¾ç¤ºçš„å†…å®¹
   - ç³»ç»Ÿé€šçŸ¥æ˜¾ç¤ºçš„å†…å®¹ï¼ˆå¯¹æ¯”ï¼‰

---

**æ›´æ–°æ—¥æœŸ**: 2025-10-13  
**çŠ¶æ€**: âœ… å·²è§£å†³  
**å…³é”®æ”¹è¿›**: ä½¿ç”¨ osascript stdin æ–¹å¼ + UTF-8 çŽ¯å¢ƒå˜é‡

